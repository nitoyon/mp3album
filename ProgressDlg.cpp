
// ProgressDlg.cpp
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

#include "ProgressDlg.h"
#include "Zip.h"
#include "resource.h"


/******************************************************************************/
//		コンストラクタおよびデストラクタ
/******************************************************************************/
// コンストラクタ
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

ProgressDlg::ProgressDlg( vector<File*>* p, const string& s)
: pvecFile( p), strArchivePath( s)
{
}


/******************************************************************************/
// デストラクタ
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

ProgressDlg::~ProgressDlg() 
{
}



/******************************************************************************/
//		メッセージハンドラ
/******************************************************************************/
// メッセージマップ定義
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

BEGIN_DLG_MESSAGE_MAP( ProgressDlgProc, ProgressDlg)
	ON_MESSAGE( WM_INITDIALOG	, OnInitDialog)
	BEGIN_COMMAND_MAP()
		ON_COMMAND( IDCANCEL		, OnCancel)
	END_COMMAND_MAP()
END_DLG_MESSAGE_MAP()


/******************************************************************************/
// 初期化
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

BOOL ProgressDlg::OnInitDialog( HWND hDlg, WPARAM wParam, LPARAM lParam) 
{
	hwndArchiveProgress = GetDlgItem( hDlg, IDC_ARCHIVEPROGRESS) ;
	hwndFileProgress = GetDlgItem( hDlg, IDC_FILEPROGRESS) ;

	SetDlgItemText( hDlg, IDC_ARCHIVENAME, strArchivePath.c_str()) ;
	hThread = CreateThread( NULL, 0, fire, (void*)this, NULL, 0) ;

	return TRUE ;
}


/******************************************************************************/
// 中断
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

BOOL ProgressDlg::OnCancel( HWND hDlg, WPARAM, LPARAM) 
{
	EndDialog( hDlg, FALSE) ;
	return TRUE ;
}


/******************************************************************************/
//		設定
/******************************************************************************/
// ファイル名設定
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

void ProgressDlg::SetFileName( const string& s)
{
	SetDlgItemText( m_hWnd, IDC_FILENAME, s.c_str()) ;
}


/******************************************************************************/
// プログレスの範囲
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

void ProgressDlg::SetProgressRange( int i, ULONG ul)
{
	if( i == 0)
	{
		SendMessage( hwndArchiveProgress, PBM_SETRANGE32, 0, ul) ;
	}
	else
	{
		SendMessage( hwndFileProgress, PBM_SETRANGE32, 0, ul) ;
	}
}


/******************************************************************************/
// プログレスの場所
//============================================================================//
// 更新：02/12/12(木)
// 概要：なし。
// 補足：なし。
//============================================================================//

void ProgressDlg::SetProgressPos( int i, ULONG j)
{
	if( i == 0)
	{
		SendMessage( hwndArchiveProgress, PBM_SETPOS, j, 0) ;
	}
	else
	{
		SendMessage( hwndFileProgress, PBM_SETPOS, j, 0) ;
	}
}
